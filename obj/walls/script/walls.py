from module.behaviors import*
from obj.enemies.walkenemy.script.walkenemy import*
from obj.player.script.player import*
from obj.enemy.script.enemy import*

all_images = image_load(os.path.dirname(__file__))
WALL_SURFACE = p.transform.scale(all_images[0], (32, 32))

class WALLS(BEHAVIORS):
    def __init__(self, x, y, index, indestructible=False):
        self.index = index
        self.size = (32, 32)
        self.color = RED 
        self.rect = p.Rect(x, y, self.size[0], self.size[1])

        self.health = 50
        self.max_health = 50
        self.indestructible = indestructible
        
        self.image = WALL_SURFACE
LEVELES = [
[
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,
    1,0,0,2,0,0,0,0,1,0,0,0,3,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,5,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,
    1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,1,0,4,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
],
 [
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,3,1,0,0,1,0,0,1,0,3,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,
    1,2,0,1,0,0,0,5,0,1,0,0,0,0,0,1,0,0,5,0,0,1,
    1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
]
]
# 0-empty, 1-wall, 2-player spawn, 3-v enemy, 4-h enemy, 5-smart enemy
## template ##
'''
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
'''
##############

maps_obj = []
last_spawn_time = p.time.get_ticks()
def create_lvl(index, enemy_spawns_list):
    global maps_obj, enemies, player, enemy_spawns, W_RESOURCES
    
    tile_size = 32
    current_x = 0
    current_y = 0
    
    row_width = 22
    count = 0

    for num in LEVELES[index]:


        if num == 1:
            is_edge = (current_x == 0 or current_x >= 672 or current_y == 0 or current_y >= 480)
            maps_obj.append(WALLS(current_x, current_y, 0, indestructible=is_edge))
        elif num == 2:
            player.pos_x = float(current_x + tile_size // 2)
            player.pos_y = float(current_y + tile_size // 2)
        elif num >= 3:
            enemy_spawns.append({"type": num, "x": current_x + 16, "y": current_y + 16})

        
        current_x += tile_size
        count += 1
        
        if count == row_width:
            current_x = 0
            current_y += tile_size
            count = 0
    random.shuffle(enemy_spawns_list)
    return maps_obj